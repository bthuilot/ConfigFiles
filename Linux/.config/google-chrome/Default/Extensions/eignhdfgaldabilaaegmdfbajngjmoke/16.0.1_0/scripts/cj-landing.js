"use strict";!function(){function n(){var n=j.icons;return n[160]||n[80]||n[128]||n[48]||n[Object.keys(j.icons)[0]]}function e(n){var e=n.split(".");return e[0]+"."+e[1]}function t(n,e,t){var i="installed"===n?v:p;browser.tabs.create({url:i.replace("[version]",e).replace("[stage]",t)})}function i(e){var i=Math.round(Date.now()*Math.random()*1e4).toString(36);browser.notifications.onClicked.addListener(function(n){n===i&&(t("updated",e,"0"),browser.notifications.clear(i))}),browser.notifications.create(i,{type:"basic",requireInteraction:!0,title:j.name+" has been updated",message:"Click to view changelog",iconUrl:n()})}function o(){b=L,browser.storage.local.set({cj_landing_versionnumber:b})}function r(n){w=n,browser.storage.local.set({cj_landing_lastupdated:w})}function s(){var n=Date.now()-w,e=864e5,t=4;return n>e?t:1+Math.floor(n/e*(t-1))}function a(){var n=e(b),i=s().toString();r(null),_.forEach(function(n){"function"==typeof n.stop&&n.stop()}),setTimeout(function(){t("updated",n,i)},2e3)}function c(){w&&C===!1&&(C=!0,_.forEach(function(n){n.init()}))}function u(){if("string"!=typeof b)return o(),m&&m("installed",b),void t("installed");var n=e(b),s=e(L);if(s!==n){if(o(),m&&m("updated",b),N)return void i(s);r(Date.now()),c()}}function l(n){var e=n.origin||"https://carlosjeurissen.com";n.websitePath&&(e+="/"+n.websitePath),v=n.installedUrl||e+"/installed",h=n.removedUrl||e+"/uninstalled",p=n.updatedUrl||e+"/updated"}function d(){return browser.storage.local.get(["cj_landing_lastupdated","cj_landing_versionnumber"]).then(function(n){w=n.cj_landing_lastupdated,b=n.cj_landing_versionnumber,g&&localStorage.versionNumber&&(b||(b=localStorage.versionNumber),localStorage.removeItem("versionNumber"))})}function f(n,e){n.useNotification&&(N=!0),n.checkOldLandingData&&(g=!0),m=e,l(n),browser.runtime.setUninstallURL(h),d().then(function(){u(),N||c()})}var b,w,g,v,p,h,m,_,j=browser.runtime.getManifest(),L=j.version,N=!1,C=!1;_=[{listener:function(n){w&&n===browser.windows.WINDOW_ID_NONE&&(1===s()?a():this.stop())},init:function(){browser.windows.onFocusChanged.addListener(this.listener)},stop:function(){browser.windows.onFocusChanged.removeListener(this.listener)}},{init:function(){w&&2===s()&&a()}},{listener:function(){if(w){var n=s();3===n?a():n>3&&this.stop()}},init:function(){browser.tabs.onCreated.addListener(this.listener)},stop:function(){browser.tabs.onCreated.removeListener(this.listener)}},{init:function D(){w&&4===s()&&a(),setTimeout(D,1e3)}}],Object.defineProperty(window,"cjLanding",{value:f})}();