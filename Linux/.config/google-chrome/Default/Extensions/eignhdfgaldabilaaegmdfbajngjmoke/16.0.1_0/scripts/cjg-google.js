!function(){"use strict";function e(e){return browser.storage.local.get(e).then(function(t){return t[e]})}function t(e){return browser.tabs.create({url:e})}function n(){return R.userid+"-"+R.pageid}function r(e,t){var n=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(t)),o={};return"string"==typeof n?o[n]=r:o=n,browser.storage.local.set(JSON.parse(JSON.stringify(o)))}function o(e){return browser.storage.local.remove(e)}function s(t){return e(n()+"-"+t)}function i(e,t){return r(n()+"-"+e,t)}function a(e){return o(n()+"-"+e)}function u(e,t){var n=t||{},r=n.fetchAs||"text";return new Promise(function(t,o){var s=new XMLHttpRequest;return s.open(n.method||"GET",e),s.addEventListener("load",function(){s.status>=200&&s.status<300?t("json"===r?JSON.parse(s.responseText):"xml"===r?s.responseXML:"html"===r?(new DOMParser).parseFromString(s.responseText,"text/html"):s.responseText):o({status:s.status,body:s.responseText})}),s.addEventListener("error",function(){o({status:s.status,body:s.responseText})}),n.headers&&Object.keys(n.headers).forEach(function(e){var t=n.headers[e];null!==t&&"undefined"!=typeof t&&s.setRequestHeader(e,t)}),"json"===r&&s.overrideMimeType("application/json"),s.send(n.body),s})}function c(e){var t=[];for(var n in e)null!==e[n]&&"undefined"!=typeof e[n]&&"undefined"!==e[n]&&t.push(n+"="+encodeURIComponent(e[n]));return 0===t.length?"":"?"+t.join("&")}function p(e,t){return e+c(t)}function d(e,t,n){for(var r=e;r.indexOf(t)>-1;)r=r.replace(t,n);return r}function h(e){if("string"!=typeof e)return null;var t=e;t.startsWith("http:")&&(t=t.replace("http:","https:")),t.startsWith("//")&&(t=t.replace("//","https://")),t.startsWith("https://")||(t="https://"+t);var n=t.split("/");return n.pop(),n.pop(),t=n.join("/")+"/mo/"}function l(e){for(var t=e[1],n=t[0][3],r=[],o=0;o<t.length;o++){var s=t[o],i=s[7].toString(),a=s[10],u=null!==s[8]&&21===s[8].length?s[8]:"none",c=[i,a,u].join("-");r.push({key:c,authuser:i,userid:a,pageid:u,email:s[3]||n,name:s[2],photo:h(s[4])})}return r}function f(){var e="https://accounts.google.com/ListAccounts?listPages=1&json=standard&origin=https%3A%2F%2Fwww.google.com";return u(e).then(function(e){var t=e;return t=d(t,"\\x","%"),t=decodeURIComponent(t),t=t.substring(t.indexOf("[")),t=t.split("]"),t.pop(),t=t.join("]")+"]",JSON.parse(t)}).then(l)}function m(){var e="https://accounts.google.com/ListAccounts?listPages=1&json=standard&source=ChromiumBrowser";return cjgOriginrequest(e,{method:"POST",fetchAs:"json",credentials:"include"}).then(l)}function w(){return u("https://www.google.com/?gws_rd=cr&authuser=0").then(function(e){var t=[];try{var n=e.split('href="https://www.google.com/webhp?authuser=');if(n[1])for(var r=1;r<n.length;r++){var o=n[r],s=o.split('"')[0],i="1",a="none",u=[s,i,a].join("-");t.push({key:u,authuser:s,photo:h(o.split('data-src="')[1].split('"')[0]),name:o.split('">')[4].split("<")[0],email:o.split('">')[5].split("<")[0].split(" ")[0],pageid:a,userid:i})}}catch(c){}return t})}function v(){return e("g-accounts-list").then(function(e){return Array.isArray(e)?e:[]})}function y(){return M||(M=f()["catch"](m)["catch"](w).then(function(e){return e},function(){return[]}).then(function(e){return r("g-accounts-list",e),e})),M}function A(e){return e?v():y()}function O(e){R=e,r("g-accounts-current",e),location.reload()}function j(){t("https://accounts.google.com/addsession?continue=https%3A%2F%2Fwww.google.com%2Fcjg-message%2Fsignin"),window.close()}function k(){t("https://accounts.google.com/logout?continue=https%3A%2F%2Fwww.google.com%2Fcjg-message%2Fsignout"),window.close()}function x(){return e("g-accounts-current").then(function(e){return e&&e.key?(R=e,void y().then(function(e){var t=!1;e.forEach(function(e){R.key===e.key&&(t=!0)}),t===!1&&(0===e.length?(o("g-accounts-current"),location.reload()):O(e[0]))})):y().then(function(e){0===e.length?R={authuser:"0",pageid:"none"}:O(e[0])})})}function b(e){return K?Q:(K=!0,C=e.clientId,q=e.key,e.lang&&(G=e.lang),x().then(function(){I="none"===R.pageid?H:U,g.clientId=C,g.key=q,g.lang=G,g.account=R,g.signedIn=R.hasOwnProperty("key"),z()}),Q)}function P(e){var t=p("https://www.googleapis.com/oauth2/v3/tokeninfo",{access_token:e.access_token,fields:"aud,scope,exp",prettyPrint:!1});return u(t,{fetchAs:"json"})}function _(){return D||(D=Promise.resolve().then(function(){var e=J&&Date.now()<N-500;if(!e)return E()}).then(function(){D=!1})),D}function S(e){Q.then(function(){var n=[];if("string"==typeof e&&(n=Array.prototype.slice.call(arguments)),Array.isArray(e)&&(n=e),0!==n.length){n.push(I);var r=p("https://accounts.google.com/o/oauth2/v2/auth",{redirect_uri:B,response_type:"token",scope:n.join(" "),state:W+"---permissionrequest",client_id:C,authuser:R.authuser,pageId:R.pageid,login_hint:R.email});t(r),window.close()}})}function F(e){return new Promise(function(t,n){var r=Array.isArray(e)?e:Array.prototype.slice.call(arguments);Q.then(_).then(function(){var o=X,s=r.every(function(e){return o.indexOf(e)!==-1});s?t(J):n({error:"notAuthorized",authorize:function(){S(e)}})})})}function L(e,t,n){var r=n.scope||[I];return F(r).then(function(n){return t.headers=t.headers||{},t.headers.Authorization="Bearer "+n,u(e,t)})}function T(e,t,n){var r=n||{};return L(e,t,r)}function E(e){var t=e||0;return t>5?Promise.resolve({error:!0}):new Promise(function(e){function n(s){if("https://www.google.com"===s.origin&&s.data.timestamp===o.toString()&&"getToken"===s.data.method)if(window.removeEventListener("message",n),document.body.removeChild(r),s.data.error)"immediate_failed"===s.data.error?(X=[],e({error:"notAuthorized"})):e(E(t));else{var i=s.data.result.access_token;P(s.data.result).then(function(n){n.aud!==C?e(E(t)):(n.token=i,J=i,X=n.scope?n.scope.split(" "):[],N=1e3*n.exp,e(n))},function(){e(E(t))})}}t++;var r,o=Date.now();window.addEventListener("message",n),r=document.createElement("iframe"),r.style.display="none",r.src=p("https://accounts.google.com/o/oauth2/auth",{redirect_uri:B,response_type:"token",include_granted_scopes:!0,scope:I,immediate:!0,state:W+"---"+o,client_id:C,authuser:R.authuser,pageId:R.pageid}),document.body.appendChild(r)})}var I,J,N,q,C,R,z,M,D,W=(navigator.userAgent.indexOf("OPR")!==-1,navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,browser.i18n.getMessage("@@extension_id")),B="https://g.carlosjeurissen.com/auth/",H="https://www.googleapis.com/auth/plus.me",U="https://www.googleapis.com/auth/youtube.readonly",X=[],G="en",K=!1,Q=new Promise(function(e){z=e});new Promise(function(e){window.addEventListener("message",function(t){t.data.cjgOriginrequestReady&&e(t.data.sapisid)})});window.g={init:b,initialized:Q,request:T,auth:{requestPermission:S,getAccessToken:F},accounts:{list:A,add:j,signout:k,change:O},cache:{getItem:s,setItem:i,remove:a}}}();