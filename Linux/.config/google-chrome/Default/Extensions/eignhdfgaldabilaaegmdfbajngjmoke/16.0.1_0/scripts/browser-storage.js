var browserObject=window.browser||this.browser;!function(){"use strict";function e(){return Promise.resolve(0)}function r(e){return function(r){return e(r).then(function(e){return e[r]})}}function t(e){return function(r,t){var n={};return n[r]=t,e(n)}}function n(){return Promise.reject()}function o(){var e={getBytesInUse:browser.storage.local.getBytesInUse,set:browser.storage.local.set,remove:browser.storage.local.remove};return u?(e.get=function(e){return e?browser.storage.local.get(e):browser.storage.local.get(null).then(function(e){var r={};return Object.keys(e).forEach(function(t){t.startsWith("__sync_storage__")||"__sync_fallback__"===t||(r[t]=e[t])}),r})},e.clear=function(){return browser.storage.local.get().then(function(e){return Object.keys(e).filter(function(e){return!e.startsWith("__sync_storage__")})}).then(browser.storage.local.remove)}):(e.get=browser.storage.local.get,e.clear=browser.storage.local.clear),e.getItem=r(e.get),e.setItem=t(e.set),e}function s(){var o={};if(u){var s=n();o.get=function(e){return s.then(function(){return browser.storage.sync.get(e)},function(){var r=null;return e&&(r="string"==typeof e?[e]:e,r=r.map(function(e){return"__sync_storage__"+e})),browser.storage.local.get(r).then(function(e){var r={};return Object.keys(e).forEach(function(t){t.startsWith("__sync_storage__")&&(r[t.replace("__sync_storage__","")]=e[t])}),r})})},o.set=function(e){return s.then(function(){return browser.storage.sync.set(e)},function(){var r={__sync_fallback__:!0};return Object.keys(e).forEach(function(t){r["__sync_storage__"+t]=e[t]}),browser.storage.local.set(r)})},o.remove=function(e){return s.then(function(){return browser.storage.sync.remove(e)},function(){var r="string"==typeof e?[e]:e;return r=r.map(function(e){return"__sync_storage__"+e}),browser.storage.local.remove(r)})},o.clear=function(){return s.then(function(){return browser.storage.sync.clear()},function(){return browser.storage.local.get(null).then(function(e){return Object.keys(e).filter(function(e){return e.startsWith("__sync_storage__")})}).then(browser.storage.local.remove)})},o.getBytesInUse=function(){return s.then(function(){return browser.storage.sync.getBytesInUse()},e)},s.then(function(){o.get=browser.storage.sync.get,o.set=browser.storage.sync.set,o.remove=browser.storage.sync.remove,o.clear=browser.storage.sync.clear})}else o.get=browser.storage.sync.get,o.set=browser.storage.sync.set,o.remove=browser.storage.sync.remove,o.clear=browser.storage.sync.clear;return o.getItem=r(o.get),o.setItem=t(o.set),o}function c(){function t(){return Promise.reject(Error("Method not supported for this storage type"))}var n=browser.storage.managed&&browser.storage.managed.get||function(){return Promise.resolve({})};return{get:n,set:t,remove:t,clear:t,getBytesInUse:e,getItem:r(n),setItem:t}}var a=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,u=a;if(!browserObject)throw new Error("browser is undefined. Make sure you included browser-polyfill.js");if(!browser.storage)throw new Error("Please add storage to the list of permissions in manifest.json");Object.defineProperty(window,"browserStorage",{value:{managed:c(),local:o(),sync:s()}})}();