cjModules.define(function(){"use strict";return function(e,n){function t(n){for(var t=e.querySelectorAll(".cj-md-appbar"),a=0;a<t.length;a++)t[a].style.backgroundColor=n}function a(e,n){return e.sort===n.sort?e.label<n.label?-1:1:e.sort<n.sort?-1:1}function i(e){N.src=P.split("#")[0]+"#"+e.replace("#","")}function r(e){i("cv/back/"+e),t("#4285f4"),v.selected="iframe"}function l(){i("co"),t("#4285f4"),v.selected="iframe"}function o(e){return g.cache.getItem("bm__cache__inbox__"+e).then(function(e){return e||""})}function c(e){var n="";return"string"==typeof e&&"inbox"!==e&&(n=e),cjBasics.ajax(I+n+"?hl="+g.lang).then(function(n){var t=document.createElement("div");t.innerHTML=n;try{var a=t.querySelector('[id][jsaction*="empty_space"] > div > div > div > div:last-child[aria-multiselectable] > div').innerHTML;return a=cjBasics.replaceAll(a,'"//',"https://"),g.cache.setItem("bm__cache__inbox__"+e,a),a}catch(i){return Error("Couldn't fetch inbox data")}})}function m(e){j.innerHTML=e}function s(n){o(n).then(m),c(n).then(m).then(function(){bmRuntime.toggleLoading("off",e)})}function b(){var n=cjMaterial.createElement("drawer");bmRuntime.toggleLoading("on",n);var i=bmElements.createElement("servicelogo",{label:bmRuntime.i18n("cj_i18n_00421","Inbox"),color:"color"});return n.appendChild(i),L.then(function(i){if(i.indexOf('],\\"clusters\\":[')!==-1){var r="["+i.split('],\\"clusters\\":[')[1].split('],\\"contacts\\"')[0]+"]";r=cjBasics.replaceAll(r,'\\"','"'),r=JSON.parse(r);var l=[],o=[],c=!1;if(r.forEach(function(e){var n;if(e.b.startsWith("^to_i_tr_")){if(B.push(e),c)return;c=!0,n=A}else{var t=e.b.replace("^","");n=H[t]||{id:t,newTabUrl:C+t,iconName:"__mdi:cj_bigtop_bundle",label:e.c[2],order:0}}0===e.c[7]?l.push(n):o.push(n)}),c===!1){var m;l.forEach(function(e,n){"sv_i"===e.id&&(m=n)}),l.splice(m,0,A)}if(l.length>0&&(l.sort(a),k.push({subHeader:bmRuntime.i18n("cj_i18n_00319","Bundled in the inbox")}),k=k.concat(l)),o.length>0){o.sort(a);var b=k.length-1;k[b].divider=!0,k.push({subHeader:bmRuntime.i18n("cj_i18n_00318","Unbundled")}),k=k.concat(o)}}else k=k.filter(function(e){return e.bigtopOnly!==!0}),D.forEach(function(e){k.push(H[e])});w=bmElements.createElement("drawertabs",{items:k,onChange:function(n,a){T.textContent=a.label,x=a.color||"#898984",t(x),bmRuntime.toggleLoading("on",e),s(a.newTabUrl.replace(I,""))},selected:"inbox"}),n.appendChild(w),bmRuntime.toggleLoading("off",n)}),n}function u(){var n=cjMaterial.createElement("appbar",{color:"#4285f4",secondary:!0}),t=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){R.open()}});n.appendChild(t),T=cjMaterial.createElement("title",{label:bmRuntime.i18n("cj_i18n_00421","Inbox")}),n.appendChild(T);var a=cjMaterial.createElement("iconbutton",{iconName:"__mdi:refresh",onClick:function(){bmRuntime.toggleLoading("on",e),s(w.selected)}});return n.appendChild(a),n}function _(){var e=cjMaterial.createElement("container"),n=u();e.appendChild(n),j=cjMaterial.createElement("container",{scrollable:!0,shadow:!0,darker:!0}),j.classList.add("inbox-container"),e.appendChild(j);var t=cjMaterial.createElement("fab",{label:bmRuntime.i18n("cj_i18n_00317","Compose"),iconName:"__mdi:create",onClick:l});return e.appendChild(t),e}function d(e){if(!e)return null;var n=e.dataset&&e.dataset.actionData;return n&&n.indexOf("#thread-f:")!==-1?n.split("#thread-f:")[1].split('"')[0]:d(e.parentNode)}function p(e){var n=d(e);return null===n?null:cjBasics.convertBase(n,10,16)}function f(e){return e?e.dataset.itemId?"cluster/%23clusters:^smartlabel_"+e.dataset.itemId.split("#clusters:^smartlabel_")[1]:f(e.parentNode):null}function h(){bmRuntime.toggleLoading("on",e),window.addEventListener("message",function(e){if("https://mail.google.com"===e.origin){if(e.data.inboxPageUrl)return void(P=e.data.inboxPageUrl);var n=e.data.inboxPageChange;if(n){var a=n.replace("#","");(a.startsWith("mn")||a.startsWith("tl"))&&(t(x),v.selected="threadlist")}}}),y={threadlist:{content:_},iframe:{loadOnInit:!0,content:function(){return N=bmElements.createElement("iframe",{src:P})}}};var a=bmElements.createElement("pageheader",{color:"#4285f4",pageId:"inbox",searchboxProperties:{onSubmit:function(e){var n="https://inbox.google.com/search/"+e+"?authuser="+g.account.authuser;bmRuntime.openTab(n)},submitInNewTab:!0}}),i=a.searchbox;R=b(),v=bmElements.createElement("multiplecontainer",{items:y,selected:"threadlist"}),v.pages.threadlist.addEventListener("click",function(n){var t=n.target,a=p(t);if(a)r(a);else{var i=f(t);i&&(bmRuntime.toggleLoading("on",e),w.selected=i,s(i))}}),e.appendChild(a),E(i.select),e.appendChild(v),e.appendChild(R),s(),n.setOpenInNewHandler(function(){var e=!1,n=w&&w.selected||"inbox";k.forEach(function(t){t.id===n&&(bmRuntime.openTab(t.newTabUrl),e=!0)}),e||bmRuntime.openTab(I)})}var v,j,R,T,w,N,x,y,E=n.onPageDisplay,U="https://mail.google.com/mail/u/"+g.account.authuser+"/",I="https://inbox.google.com/u/"+g.account.authuser+"/",C=I+"cluster/%23clusters:^",M="bm_mail_inbox_"+g.account.authuser+"_"+g.account.userid,P=cjBasics.urls.create("https://mail.google.com/mail/mu/mp/",{mui:M,hl:g.lang,authuser:g.account.authuser},"#mn"),L=cjBasics.ajax(I+"snoozed?hl="+g.lang),S=[],O={};!function(){function e(e,n){O[e]={label:n,items:[]},S.push(e)}var n=new Date,t=[bmRuntime.i18n("cj_i18n_00165","January"),bmRuntime.i18n("cj_i18n_00166","February"),bmRuntime.i18n("cj_i18n_00167","March"),bmRuntime.i18n("cj_i18n_00168","April"),bmRuntime.i18n("cj_i18n_00169","May"),bmRuntime.i18n("cj_i18n_00170","June"),bmRuntime.i18n("cj_i18n_00171","July"),bmRuntime.i18n("cj_i18n_00172","August"),bmRuntime.i18n("cj_i18n_00173","September"),bmRuntime.i18n("cj_i18n_00174","October"),bmRuntime.i18n("cj_i18n_00175","November"),bmRuntime.i18n("cj_i18n_00176","December")],a=1e3,i=60*a,r=60*i,l=24*r,o=n.getTime()-n.getHours()*r-n.getMinutes()*i-n.getSeconds()*a-n.getMilliseconds();e(o,"Today");var c=o-864e5;e(c,"Yesterday");var m=c-n.getDay()*l;e(m,"This month");for(var s=n.getMonth()-1,b=new Date(m);s>-1;)b.setMonth(s-1),e(b.getTime(),t[s]),s--;e(0,"Older")}();var k=[{id:"inbox",label:bmRuntime.i18n("cj_i18n_00299","Inbox"),iconName:"__mdi:inbox",newTabUrl:I,color:"#4285f4",colorIcon:!0},{id:"snoozed",label:bmRuntime.i18n("cj_i18n_00300","Snoozed"),iconName:"__mdi:schedule",newTabUrl:I+"snoozed",bigtopOnly:!0,color:"#ef6c00",colorIcon:!0},{id:"done",label:bmRuntime.i18n("cj_i18n_00301","Done"),iconName:"__mdi:bigtop_done",newTabUrl:I+"done",color:"#34a853",divider:!0,colorIcon:!0},{id:"drafts",label:bmRuntime.i18n("cj_i18n_00187","Drafts"),iconName:"__mdi:drafts",newTabUrl:I+"drafts"},{id:"sent",label:bmRuntime.i18n("cj_i18n_00303","Sent"),iconName:"__mdi:send",newTabUrl:I+"sent"},{id:"reminders",label:bmRuntime.i18n("cj_i18n_00304","Reminders"),iconName:"__mdi:reminders_alt",bigtopOnly:!0,newTabUrl:I+"reminders"},{id:"trash",label:bmRuntime.i18n("cj_i18n_00005","Trash"),iconName:"__mdi:delete",newTabUrl:I+"trash"},{id:"spam",label:bmRuntime.i18n("cj_i18n_00306","Spam"),iconName:"__mdi:report",newTabUrl:I+"spam",divider:!0}],A={id:"trips",label:bmRuntime.i18n("cj_i18n_00307","Trips"),iconName:"__mdi:travel",newTabUrl:I+"trips",color:"#9c27b0",sort:1,colorIcon:!0},B=[],D=["smartlabel_travel","smartlabel_receipt","smartlabel_finance","smartlabel_social","smartlabel_pure_notif","smartlabel_group","smartlabel_promo"],H={smartlabel_travel:{id:"smartlabel_travel",label:bmRuntime.i18n("cj_i18n_00308","Travel"),iconName:"travel",newTabUrl:C+"smartlabel_travel",gmailPath:U+"#search/category%3Atravel",color:"#9c27b0",colorIcon:!0,sort:1},sv_i:{id:"sv_i",label:bmRuntime.i18n("cj_i18n_00309","Saved"),iconName:"__mdi:bookmark",newTabUrl:C+"sv_i",color:"#4285f4",colorIcon:!0,sort:2},smartlabel_receipt:{id:"smartlabel_receipt",label:bmRuntime.i18n("cj_i18n_00310","Purchases"),iconName:"__mdi:shopping_cart",newTabUrl:C+"smartlabel_receipt",gmailPath:U+"#search/category%3Apurchases",color:"#795548",colorIcon:!0,sort:3},smartlabel_finance:{id:"smartlabel_finance",label:bmRuntime.i18n("cj_i18n_00311","Finance"),iconName:"__mdi:trending_up",newTabUrl:C+"smartlabel_finance",gmailPath:U+"#search/category%3Afinance",color:"#689f38",colorIcon:!0,sort:4},smartlabel_social:{id:"smartlabel_social",label:bmRuntime.i18n("cj_i18n_00312","Social"),iconName:"__mdi:people",newTabUrl:C+"smartlabel_social",gmailPath:U+"#category/social",color:"#db4437",colorIcon:!0,sort:5},smartlabel_pure_notif:{id:"smartlabel_pure_notif",label:bmRuntime.i18n("cj_i18n_00313","Updates"),iconName:"__mdi:flag",newTabUrl:C+"smartlabel_pure_notif",gmailPath:U+"#category/updates",color:"#ff6839",colorIcon:!0,sort:6},smartlabel_group:{id:"smartlabel_group",label:bmRuntime.i18n("cj_i18n_00182","Forums"),iconName:"__mdi:question_answer",newTabUrl:C+"smartlabel_group",gmailPath:U+"#category/forums",color:"#3f51b5",colorIcon:!0,sort:7},smartlabel_promo:{id:"smartlabel_promo",label:bmRuntime.i18n("cj_i18n_00315","Promos"),iconName:"__mdi:local_offer",newTabUrl:C+"smartlabel_promo",gmailPath:U+"#category/promotions",color:"#00bcd4",colorIcon:!0,sort:8},io_unim:{id:"io_unim",label:bmRuntime.i18n("cj_i18n_00316","Low Priority"),iconName:"__mdi:low_priority",newTabUrl:C+"io_unim",sort:9}};h()}});