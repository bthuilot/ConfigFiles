cjModules.define(function(){"use strict";return function(e,t){function a(){var e=cjMaterial.createElement("drawer",{color:"#4285f4"}),t=bmElements.createElement("servicelogo",{label:bmRuntime.i18n("cj_i18n_00429","Photos"),color:"color"});e.appendChild(t);var a=bmElements.createElement("drawertabs",{items:m,onChange:function(t){e.close(),s.selected=t},selected:p});return e.appendChild(a),e}function n(e){var t=cjBasics.urls.create("https://picasaweb.google.com/data/feed/api/user/"+g.account.userid,{fields:"entry(gphoto:id,media:group(media:thumbnail,media:title))",kind:"album","max-results":e||999999999,thumbsize:320,alt:"atom"});return cjBasics.ajax(t,{fetchAs:"html"}).then(function(e){for(var t=[],a=e.querySelectorAll("feed > entry"),n=0;n<a.length;n++){var o=a[n];try{var c="Auto Backup"===o.querySelector("media\\:title").textContent,i=o.querySelector("gphoto\\:id").textContent;t.push({id:c?"autoBackup":i,thumbnail:o.querySelector("media\\:thumbnail").getAttribute("url"),name:o.querySelector("media\\:title").textContent})}catch(r){}}return t})}function o(e){var t=cjMaterial.createElement("griditem");t.classList.add("photos__griditem"),t.dataset.id=e.id;var a=document.createElement("div");if(a.className="photos__griditem__thumbnail",a.style.backgroundImage='url("'+e.thumbnail.replace("/s320/",v)+'")',t.appendChild(a),e.name){var n=document.createElement("div");n.className="cj-md-grid__item__bottom photos__griditem__bottom",t.appendChild(n);var o=document.createElement("div");o.className="cj-md-grid__item__textcontainer",o.textContent=e.name,n.appendChild(o),e.name.length>20&&(o.title=e.name)}return t}function c(e,t,a,n){for(var c=document.createDocumentFragment(),i=a;i<n;i++)t[i]&&c.appendChild(o(t[i]));e.appendChild(c)}function i(){var e=cjMaterial.createElement("container");bmRuntime.toggleLoading("on",e);var t=cjMaterial.createElement("appbar",{color:"#fff",secondary:!0,light:!0}),a=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){d.open()}});t.appendChild(a);var o=cjMaterial.createElement("title",{label:m.albums.label});t.appendChild(o),e.appendChild(t);var i,r=new Promise(function(e){i=e}),l=f,u=cjMaterial.createElement("gridcontainer");u.addEventListener("click",function(e){if(e.target.classList.contains("photos__griditem")){var t,a=e.target.dataset.id;t="autoBackup"===a?cjBasics.urls.create(_+"search/%23AutoBackup",{authuser:g.account.authuser,pageId:g.account.pageid}):cjBasics.urls.create(b+"/"+g.account.userid+"/albums/"+a+"/",{authuser:g.account.authuser,pageId:g.account.pageid}),bmRuntime.openTab(t)}});var s=cjMaterial.createElement("container",{scrollable:!0,shadow:"onScroll",onScrollBottom:function(){var e=l;l+=f,r.then(function(t){c(u,t,e,l)})}});return e.appendChild(s),s.appendChild(u),g.cache.getItem("bm__cache__photos__albums").then(function(e){Array.isArray(e)&&e.length>0&&c(u,e,0,e.length<f?e.length:f)}),n().then(function(t){u.textContent="",c(u,t,0,f),bmRuntime.toggleLoading("off",e),i(t),g.cache.setItem("bm__cache__photos__albums",t)}),e}function r(e){var t=cjBasics.urls.create("https://picasaweb.google.com/data/feed/api/user/"+g.account.userid,{fields:"entry(gphoto:id,media:group(media:thumbnail, media:title))","max-results":e||999999999,thumbsize:320,kind:"photo",alt:"atom"});return cjBasics.ajax(t,{fetchAs:"html"}).then(function(e){for(var t=[],a=e.querySelectorAll("feed > entry"),n=0;n<a.length;n++){var o=a[n];try{t.push({id:o.querySelector("gphoto\\:id").textContent,thumbnail:o.querySelector("media\\:thumbnail").getAttribute("url")})}catch(c){}}return t})}function l(){var e=cjMaterial.createElement("container");bmRuntime.toggleLoading("on",e);var t=cjMaterial.createElement("appbar",{color:"#fff",secondary:!0,light:!0}),a=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){d.open()}});t.appendChild(a);var n=cjMaterial.createElement("title",{label:m.allPhotos.label});t.appendChild(n),e.appendChild(t);var o,i=new Promise(function(e){o=e}),l=f,u=cjMaterial.createElement("gridcontainer");u.addEventListener("click",function(e){if(e.target.classList.contains("photos__griditem")){var t=cjBasics.urls.create(b+"/highlights",{pid:e.target.dataset.id,oid:g.account.userid,authuser:g.account.authuser,pageId:g.account.pageid});bmRuntime.openTab(t)}});var s=cjMaterial.createElement("container",{scrollable:!0,shadow:"onScroll",onScrollBottom:function(){var e=l;l+=f,i.then(function(t){c(u,t,e,l)})}});return s.appendChild(u),e.appendChild(s),g.cache.getItem("bm__cache__photos__photos").then(function(e){Array.isArray(e)&&e.length>0&&c(u,e,0,e.length<f?e.length:f)}),r().then(function(t){u.textContent="",c(u,t,0,f),bmRuntime.toggleLoading("off",e),o(t),g.cache.setItem("bm__cache__photos__photos",t)}),e}function u(){m={allPhotos:{label:bmRuntime.i18n("cj_i18n_00399","Photos"),iconName:"__mdi:photo",content:l,newTabUrl:_},albums:{label:bmRuntime.i18n("cj_i18n_00400","Albums"),iconName:"__mdi:collections",content:i,newTabUrl:_+"albums"}},d=a();var n=bmElements.createElement("pageheader",{color:"#fff",pageId:"photos",light:!0,searchboxProperties:{color:"#4285f4",onSubmit:function(e){bmRuntime.openTab("https://photos.google.com/u/"+g.account.authuser+"/search/"+e)},submitInNewTab:!0}});s=bmElements.createElement("multiplecontainer",{items:m,selected:p}),e.appendChild(s),h(n.searchbox.select);var o=document.createDocumentFragment();o.appendChild(d),o.appendChild(n),o.appendChild(s),e.appendChild(o),t.setOpenInNewHandler(function(){var e=m[s.selected].newTabUrl;bmRuntime.openTab(e)})}var s,m,d,h=t.onPageDisplay,p="allPhotos",b="https://plus.google.com/photos",_="https://photos.google.com/";"0"!==g.account.authuser&&(_+="u/"+g.account.authuser),"none"!==g.account.pageid&&(_+="b/"+g.account.pageid);var f=21,v="/s"+(cjBasics.isRetina?"288":"144")+"-p-no/";u()}});