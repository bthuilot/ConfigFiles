cjModules.define(function(){"use strict";return function(e,t){function n(e){return parseInt(e.split("id-")[1],10)}function a(t){if(t&&"notAuthorized"===t.error){e.textContent="";var n=bmElements.createElement("fulldialog",{serviceLogo:{label:bmRuntime.i18n("cj_i18n_00285","Play Books")},iconName:"play_books",message:bmRuntime.i18n("cj_i18n_00321","Before you can use this page, you need to give access to load your Google Books. In case you only want to search for books, navigate to the search page in this extension."),actionLabel:bmRuntime.i18n("cj_i18n_00224","Give permission"),action:t.authorize});e.appendChild(n)}}function o(e){var t="undefined"!=typeof e.shelf;if(t&&e.noCache!==!0)return g.cache.getItem("bm__cache__books__shelf__"+e.shelf).then(function(t){return e.noCache=!0,t?{result:t,newRequest:!0,freshRequest:function(){return o(e)}}:o(e)});e.startIndex=e.startIndex||0;var n=A;"undefined"!=typeof e.shelf&&(n+="mylibrary/bookshelves/"+e.shelf+"/"),n+="volumes";var i=cjBasics.urls.create(n,{q:e.q,maxResults:e.maxResults,hl:g.lang,filter:t?null:e.searchFilter,startIndex:e.startIndex});return g.request(i,{fetchAs:"json"},{internal:!0,scope:N}).then(function(n){var a=n.items,r=[];a&&a.forEach(function(e){var t=e.volumeInfo;r.push({id:e.id,title:t.title,previewLink:t.previewLink,authors:t.authors,openBook:i.indexOf("mylibrary/bookshelves")!==-1})});var l={result:r,newRequest:0===e.startIndex};return t&&0===e.startIndex&&g.cache.setItem("bm__cache__books__shelf__"+e.shelf,r),n.items=n.items||[],n.totalItems-e.startIndex-n.items.length!==0&&(l.followupRequest=function(){return e.startIndex+=e.maxResults,o(e)}),l},a)}function i(e){return o({maxResults:P,searchFilter:C.selected,shelf:e.shelf,q:e.q}).then(function(e){return _=e.followupRequest,e})}function r(e){var t=cjMaterial.createElement("griditem");t.addEventListener("click",function(){var t=(e.openBook&&e.previewLink?e.previewLink:"https://play.google.com/store/books/details/?id="+e.id)+"&authuser="+g.account.authuser;bmRuntime.openTab(t)});var n=cjBasics.urls.create("https://books.google.com/books/reader",{printsec:"frontcover",img:"1",zoom:"1",id:e.id}),a=document.createElement("div");a.className="bookitem__thumbnail",a.style.backgroundImage='url("'+n+'")',t.appendChild(a);var o=document.createElement("div");o.className="cj-md-grid__item__bottom",t.appendChild(o);var i=document.createElement("div");i.className="cj-md-grid__item__textcontainer",o.appendChild(i);var r=document.createElement("div");r.textContent=e.title,i.appendChild(r);var l=20;if(Array.isArray(e.authors)){var s=document.createElement("div");s.className="cj-md-secondarytext",s.textContent=e.authors.join(" "),i.appendChild(s)}var c;return e.previewLink&&!e.openBook&&(l-=5,c=cjMaterial.createElement("iconbutton",{iconName:"__mdi:visibility",label:"Preview",onClick:function(){bmRuntime.openTab(e.previewLink+"&authuser="+g.account.authuser)}}),o.appendChild(c)),cjColors.getDominantColor(n).then(function(e){o.style.backgroundColor=e.css,e.dark&&o.classList.add("cj-md--dark")}),e.title.length>l&&(r.title=e.title),t}function l(){var e=cjMaterial.createElement("emptystate",{color:T,label:bmRuntime.i18n("cj_i18n_00322","No books found"),iconName:"__mdi:book"});y.appendChild(e)}function s(t){var n=t.result;t.newRequest&&(y.textContent="",w=cjMaterial.createElement("gridcontainer"),y.appendChild(w),0===n.length&&l()),0!==n.length&&n.forEach(function(e){var t=r(e);w.appendChild(t)}),t.freshRequest?t.freshRequest().then(s):bmRuntime.toggleLoading("off",e)}function c(){I.searchmenu.hide(),bmRuntime.toggleLoading("on",e),y.textContent="",R.dataset.selected="search";var t=x.value;j=t,i({q:t}).then(s)}function u(e){var t=cjBasics.urls.create("https://play.google.com/store/search",{q:e,hl:g.lang,c:"books",authuser:g.account.authuser});bmRuntime.openTab(t)}function d(){var e=cjBasics.urls.create(A+"mylibrary/bookshelves",{fields:"items(id,title,volumeCount)",hl:g.lang});return g.request(e,{headers:{"GData-Version":"3.0"},fetchAs:"json"},{internal:!0,scope:N}).then(function(e){if(e.items.length<=0)return Promise.reject({error:"noItems"});var t=e.items.map(function(e){return{id:"id-"+e.id,label:7===e.id?bmRuntime.i18n("cj_i18n_00323","My Books"):e.title,newTabUrl:cjBasics.urls.create("https://books.google.com/books",{as_coll:e.id,authuser:g.account.authuser,hl:g.lang})}});return t.sort(function(e){return"id-7"===e.id?-1:1}),t})}function m(e){var t=cjBasics.urls.create("https://www.google.com/complete/search",{client:"serp",authuser:g.account.authuser,xhr:"t",hl:g.lang,q:e,ds:"bo"});return cjBasics.ajax(t,{fetchAs:"json"})}function h(e){var t=Date.now();m(e).then(function(e){if(!(k>t)){k=t,L.textContent="";var n=e[1];if(n.length>0){for(var a=0;a<n.length;a++){var o,i=n[a],r=i[0],l=i[3];l&&l.b&&l.c?(r+="â€“ "+l.b,o=l.c):o=r.split("<b>").join("").split("</b>").join("");var s=cjMaterial.createElement("item");s.dataset.value=o,s.innerHTML=r,L.appendChild(s)}I.searchmenu.show()}else I.searchmenu.hide()}})}function p(){var t=cjMaterial.createElement("appbar",{color:"#fff",light:!0,secondary:!0});t.dataset.selected="mybooks";var a=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){E.open()}});a.dataset.view="mybooks",t.appendChild(a),q=cjMaterial.createElement("title",{label:bmRuntime.i18n("cj_i18n_00323","My Books")}),q.dataset.view="mybooks",t.appendChild(q);var o=cjMaterial.createElement("iconbutton",{iconName:"__mdi:arrow_back",onClick:function(){bmRuntime.toggleLoading("on",e),t.dataset.selected="mybooks",x.clear(),i({shelf:n(M.selected)}).then(s)}});o.dataset.view="search",t.appendChild(o);var r=cjMaterial.createElement("title",{label:"Search"});return r.dataset.view="search",t.appendChild(r),C=cjMaterial.createElement("selectbox",{onChange:c,options:[{value:"ebooks",label:bmRuntime.i18n("cj_i18n_00198","All prices"),selected:!0},{value:"free-ebooks",label:bmRuntime.i18n("cj_i18n_00199","Free")},{value:"paid-ebooks",label:bmRuntime.i18n("cj_i18n_00200","Paid")}]}),C.dataset.view="search",t.appendChild(C),t}function b(){_&&_().then(s)}function f(){var o=cjMaterial.createElement("drawer",{color:T});bmRuntime.toggleLoading("on",o);var r=bmElements.createElement("servicelogo",{labelPrefix:"google_logo Play ",label:bmRuntime.i18n("cj_i18n_00324","Books"),color:T});return o.appendChild(r),d().then(function(a){M=bmElements.createElement("drawertabs",{items:a,onChange:function(t,a){bmRuntime.toggleLoading("on",e),y.textContent="",a&&(S=a.newTabUrl,q.textContent=a.label),i({shelf:n(t)}).then(s)},selected:"id-7"}),t.setOpenInNewHandler(function(){"search"===R.dataset.selected?u(j):bmRuntime.openTab(S)}),o.appendChild(M),bmRuntime.toggleLoading("off",o)},a),o}function v(){bmRuntime.toggleLoading("on",e),I=bmElements.createElement("pageheader",{color:"#fff",light:!0,pageId:"books",includeSearchMenu:!0,searchboxProperties:{color:T,onClear:function(){I.searchmenu.hide()},onInput:h,onSubmit:c,onSubmitAlt:u}}),L=cjMaterial.createElement("list"),L.classList.add("bm-ele-autocomplete"),L.addEventListener("click",function(e){var t=e.target.dataset.value;I.searchbox.value=t,c(t)}),I.searchmenu.appendChild(L),x=I.searchbox,E=f(),e.appendChild(E),R=p(),y=cjMaterial.createElement("container",{scrollable:!0,shadow:!0,onScrollBottom:b}),e.appendChild(I),B(x.select),e.appendChild(R),e.appendChild(y),e.appendChild(E),i({shelf:7}).then(s)}var _,k,j,C,w,y,R,x,E,L,I,M,q,B=t.onPageDisplay,N=["https://www.googleapis.com/auth/books"],A="https://www.googleapis.com/books/v1/",P=12,T="#03a9f4",S="https://play.google.com/books?authuser="+g.account.authuser;v()}});