cjModules.define(function(){"use strict";return function(e,t){function n(e){Y.style.backgroundColor=e?"#000":"#fff",Y.classList.toggle("cj-md--dark",e)}function i(e){var t="https://www.youtube.com/";return g.signedIn?cjBasics.urls.create(t+"signin",{pageid:g.account.pageid,authuser:g.account.authuser,next:e}):t+e}function a(e){var t=i(e);bmRuntime.openTab(t)}function l(e){var t=document.createElement("iframe");K=t,t.className="video-player-frame",t.setAttribute("allowfullscreen",""),t.setAttribute("webkitallowfullscreen",""),t.setAttribute("mozallowfullscreen","");var n=cjBasics.urls.create("https://www.youtube.com/embed/"+e,{autoplay:1,theme:"light",showinfo:0,html5:1,autohide:0,fs:1,hl:g.lang});return t.src=n,t}function c(e){for(var t=[2,3,4,5,7,8,9],n=[0,0,0,0,0,0,0],i=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(e),a=0;a<t.length;a++){var l=t[a];n[a]=i[l]?Number(i[l].replace(/[A-Za-z]+/g,"")):0}var c=n[4]+24*(n[3]+7*n[2]+30*n[1]+360*n[0]),o=1===n[5].toString().length?"0"+n[5]:n[5],r=1===n[6].toString().length?"0"+n[6]:n[6],d=(0===c?"":c+":")+o+":"+r;return d}function o(e,t,n){var i=["activities","subscriptions","channels","playlistItems"],a=i.indexOf(e)!==-1||n,l={hl:g.lang,key:g.key,maxResults:oe};"object"==typeof t&&Object.keys(t).forEach(function(e){l[e]=t[e]});var c=cjBasics.urls.create(le+e,l),o={fetchAs:"json"};return a?g.request(c,o,{scope:ce}):cjBasics.ajax(c,o)}function r(){X.textContent="",$=cjMaterial.createElement("list"),X.appendChild($)}function d(){X.textContent="";var e=cjMaterial.createElement("emptystate",{color:de,iconName:"__mdi:video_youtube",label:bmRuntime.i18n("cj_i18n_00156","No results")});X.appendChild(e)}function s(e){var t=document.createDocumentFragment(),n=cjMaterial.createElement("card",{withPadding:!0}),i=cjMaterial.createElement("title");n.appendChild(i);var a=document.createElement("div");a.className="video-player-channel",n.appendChild(a),t.appendChild(n);var l=cjMaterial.createElement("card",{withPadding:!0}),c=document.createElement("div");c.className="video-player-published-at",l.appendChild(c);var o=document.createElement("div");o.className="video-player-description",l.appendChild(o),t.appendChild(l);var r=cjBasics.urls.create("https://www.googleapis.com/youtube/v3/videos",{part:"snippet,statistics",id:e,key:g.key});return cjBasics.ajax(r,{fetchAs:"json"}).then(function(e){var t=e.items[0],n=t.snippet;c.textContent="Published on "+new Date(n.publishedAt).toDateString(),i.textContent=n.title,o.textContent=n.description,cjgModules.load("ytsubscribe").then(function(){gapi.ytsubscribe.render(a,{channelid:n.channelId,layout:"full",card:1})})}),t}function u(e){var t=cjMaterial.createElement("card"),n=document.createElement("div");return n.className="video-player-comments",t.appendChild(n),cjgModules.load("comments").then(function(){gapi.comments.render(n,{href:"http://www.youtube.com/watch?v="+e,query:"http://www.youtube.com/watch?v="+e,search:"?v="+e,first_party_property:"YOUTUBE",bm_contentscript:"youtubecomments",authuser:g.account.authuser,pageId:g.account.pageid,hl:g.lang,width:384,view_type:"FILTERED",gsrc:"1p",youtube_video_acl:"PUBLIC"})}),t}function m(t){var n=U;bmRuntime.toggleLoading("on",e),n.textContent="";var i=l(t);i.addEventListener("load",function(){bmRuntime.toggleLoading("off",e)}),n.appendChild(i);var a=s(t);n.appendChild(a);var c=u(t);n.appendChild(c),W=t}function p(e){var t=cjBasics.urls.create("https://www.google.com/complete/search",{client:"serp",authuser:g.account.authuser,xhr:"t",q:e,ds:"yt"});return cjBasics.ajax(t,{fetchAs:"json"})}function h(e){var t=Date.now();p(e).then(function(e){if(!(V>t)){V=t,te.textContent="";var n=e[1];if(n.length>0){for(var i=0;i<n.length;i++){var a,l=n[i],c=l[0],o=l[3];o&&o.b&&o.c?(c+="â€“ "+o.b,a=o.c):a=c.split("<b>").join("").split("</b>").join("");var r=cjMaterial.createElement("item");r.dataset.value=a,r.innerHTML=c,te.appendChild(r)}Y.searchmenu.show()}else Y.searchmenu.hide()}})}function b(e){var t=cjMaterial.createElement("item",{multiline:!0});t.classList.add("video-item"),t.dataset.videoId=e.videoId,t.addEventListener("click",function(){ne.selected="videoPlayer",m(e.videoId),setTimeout(function(){n(!0)})});var i=document.createElement("div");i.className="video-item-image",i.setAttribute("style","background-image: url('"+e.imageUrl+"');"),i.dataset.duration=e.duration,t.appendChild(i);var l=document.createElement("div");l.className="cj-md-item__body";var c=document.createElement("div");c.className="video-item-title cj-md-item__header",c.textContent=e.videoTitle,l.appendChild(c);var o=document.createElement("div");o.className="cj-md-secondarytext",o.textContent=e.channelTitle,l.appendChild(o),t.appendChild(l);var r=cjMaterial.createElement("iconbutton",{iconName:"__mdi:open_in_new",label:bmRuntime.i18n("cj_i18n_00045","Open video in a new tab"),onClick:function(e){a("watch?v="+this.parentNode.dataset.videoId),e.stopPropagation()}});r.classList.add("video-item-openinnew"),t.appendChild(r),$.appendChild(t)}function f(t,n){0===t.length?(d(),bmRuntime.toggleLoading("off",e)):o("videos",{part:"snippet,contentDetails,id",fields:"items(contentDetails/duration,id,snippet/title,snippet/channelTitle,snippet/thumbnails/default/url)",id:t.join(",")},n).then(function(t){var n=t.items,i={};n.forEach(function(e){var t=e.id;i[t]={videoId:t,imageUrl:e.snippet.thumbnails["default"].url,channelTitle:e.snippet.channelTitle,videoTitle:e.snippet.title,duration:c(e.contentDetails.duration)}}),Object.keys(i).forEach(function(e){b(i[e])}),bmRuntime.toggleLoading("off",e)})}function v(t,n){Q.textContent=bmRuntime.i18n("cj_i18n_00159","Search"),e.classList.add("search"),z=v,n||(r(),re=[]),bmRuntime.toggleLoading("on",e);var i={part:"id",fields:"items(id/videoId),nextPageToken",type:"video",order:G.selected};"object"==typeof t&&Object.keys(t).forEach(function(e){i[e]=t[e]}),o("search",i).then(function(e){H=e.nextPageToken;var t=e.items.map(function(e){return e.id.videoId});re=re.concat(t),f(t)})}function _(t,n){z=_,bmRuntime.toggleLoading("on",e),n||(r(),re=[]);var i={part:"id",fields:"items(id),nextPageToken",chart:"mostPopular"};"object"==typeof t&&Object.keys(t).forEach(function(e){i[e]=t[e]}),o("videos",i).then(function(e){H=e.nextPageToken;var t=e.items.map(function(e){return e.id});re=re.concat(t),f(t)})}function j(){var e=Z.value;if(0===Z.value.length)return null;var t,n,i=e.split(" ");return i.forEach(function(e){e.indexOf("duration:")!==-1&&(t=e.split("duration:")[1],i.splice(i.indexOf(e),1)),e.indexOf("type:")!==-1&&(n=e.split("type:")[1],i.splice(i.indexOf(e),1))}),{q:i.join(" "),videoDuration:t,videoType:n}}function y(){Y.searchmenu.hide();var t=j();if(t)v(t);else if(e.classList.remove("search"),A){var i=A.selected;F[i].action(),Q.textContent=F[i].label}else Q.textContent=bmRuntime.i18n("cj_i18n_00153","Trending"),_();ne.selected="searchResults",setTimeout(function(){n(!1)})}function C(e){var t=cjMaterial.createElement("appbar",{color:"#000",secondary:!0}),i=cjMaterial.createElement("iconbutton",{iconName:"__mdi:arrow_back",onClick:function(){ne.selected="searchResults",K.src="about:blank",setTimeout(function(){n(!1)})}});t.appendChild(i);var a=cjMaterial.createElement("title",{label:bmRuntime.i18n("cj_i18n_00162","Back")});t.appendChild(a);var l=cjMaterial.createElement("iconbutton",{iconName:"__mdi:chevron_left",onClick:function(){var e=W,t=document.querySelector(".video-item[data-video-id='"+e+"']").previousSibling.dataset.videoId;t&&m(t)}});t.appendChild(l);var c=cjMaterial.createElement("iconbutton",{iconName:"__mdi:chevron_right",onClick:function(){var e=W,t=document.querySelector(".video-item[data-video-id='"+e+"']");if(t){var n=t.nextSibling;if(n){var i=n.dataset.videoId;m(i)}}}});t.appendChild(c),e.appendChild(t),U=cjMaterial.createElement("container",{scrollable:!0,shadow:!0}),e.appendChild(U)}function E(){z({pageToken:H},!0)}function w(e){J=cjMaterial.createElement("appbar",{color:"#fff",secondary:!0,light:!0}),J.classList.add("main-toolbar");var t=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){ie.open()}});J.appendChild(t);var n=cjMaterial.createElement("title",{label:bmRuntime.i18n("cj_i18n_00153","Trending")});Q=n,J.appendChild(n);var i=cjMaterial.createElement("iconbutton",{iconName:"__mdi:refresh",label:bmRuntime.i18n("cj_i18n_00157","Reload"),onClick:function(){if(A){var e=A.selected;F[e].action(),Q.textContent=F[e].label}else Q.textContent=bmRuntime.i18n("cj_i18n_00153","Trending"),_()}});J.appendChild(i);var l=cjMaterial.createElement("fab",{color:de,label:bmRuntime.i18n("cj_i18n_00158","Upload video"),iconName:"__mdi:file_upload",onClick:function(){a("upload")}});e.appendChild(l),e.appendChild(J);var c=cjMaterial.createElement("appbar",{color:"#fff",secondary:!0,light:!0});c.classList.add("search-toolbar");var o=cjMaterial.createElement("iconbutton",{iconName:"__mdi:arrow_back",onClick:function(){Z.clear(),y()}});c.appendChild(o);var r=cjMaterial.createElement("title",{label:bmRuntime.i18n("cj_i18n_00159","Search")});c.appendChild(r),G=cjMaterial.createElement("selectbox",{onChange:y,options:[{value:"date",label:bmRuntime.i18n("cj_i18n_00035","sort by date")},{value:"rating",label:bmRuntime.i18n("cj_i18n_00036","sort by rating")},{selected:!0,value:"relevance",label:bmRuntime.i18n("cj_i18n_00037","sort by relevance")},{value:"title",label:bmRuntime.i18n("cj_i18n_00038","sort by title")},{value:"viewCount",label:bmRuntime.i18n("cj_i18n_00039","sort by views")}]}),c.appendChild(G),e.appendChild(c),X=cjMaterial.createElement("container",{scrollable:!0,shadow:!0,onScrollBottom:E}),$=cjMaterial.createElement("list"),X.appendChild($),e.appendChild(X)}function x(){return o("subscriptions",{part:"snippet",fields:"items(snippet/resourceId/channelId,snippet/title, snippet/thumbnails/default/url)",mine:!0,maxResults:50}).then(function(e){return e.items.map(function(e){return{channelId:e.snippet.resourceId.channelId,title:e.snippet.title,thumbnail:e.snippet.thumbnails["default"].url}})})}function R(){bmRuntime.toggleLoading("on",e),o("channels",{part:"contentDetails",fields:"items(contentDetails/relatedPlaylists/uploads)",mine:!0},!0).then(function(t){function n(t,n){bmRuntime.toggleLoading("on",e),n||(r(),re=[]);var a={part:"contentDetails",playlistId:i,fields:"items(contentDetails/videoId),nextPageToken"};"object"==typeof t&&Object.keys(t).forEach(function(e){a[e]=t[e]}),o("playlistItems",a,!0).then(function(e){var t=e.items.map(function(e){return e.contentDetails.videoId});re=re.concat(t),f(t,!0)})}var i=t.items[0].contentDetails.relatedPlaylists.uploads;z=n,n()})}function M(t,n,i){z=function(e,n){M(t,e,n)},bmRuntime.toggleLoading("on",e),i||(r(),re=[]);var a={part:"contentDetails",fields:"items(contentDetails),nextPageToken",channelId:t,maxResults:50};"object"==typeof n&&Object.keys(n).forEach(function(e){a[e]=n[e]}),o("activities",a).then(function(e){H=e.nextPageToken;var t=[];e.items.forEach(function(e){var n=e.contentDetails.upload;n&&t.push(n.videoId)}),re=re.concat(t),f(t)})}function k(){x().then(function(e){if(0===e.length)q?q*=3:q=1e3,setTimeout(k,q);else{var t=cjMaterial.createElement("subheader",{color:de,label:bmRuntime.i18n("cj_i18n_00154","Subscriptions")});ie.appendChild(t);var n={};e.forEach(function(e){n[e.channelId]={label:e.title,icon:{withShell:!0,url:e.thumbnail.replace("s88",cjBasics.isRetina?"s80":"s40"),size:40},newTabUrl:i("channel/"+e.channelId)}});var a=bmElements.createElement("drawertabs",{items:n,onChange:function(e){Q.innerHTML=a.querySelector('.cj-md-item[data-id="'+e+'"]').textContent,M(e),ie.close()}});ie.appendChild(a)}})}function T(){Q.textContent=bmRuntime.i18n("cj_i18n_00153","Trending");var e=bmElements.createElement("servicelogo",{labelPrefix:"",label:""});ie.appendChild(e),ee&&ee.parentNode.removeChild(ee),A=bmElements.createElement("drawertabs",{items:F,onChange:function(e){ie.close(),F[e].action(),Q.textContent=F[e].label},selected:"trending"}),ie.appendChild(A),_(),k()}function L(){g.auth.requestPermission(ce)}function I(){_(),Q.textContent=bmRuntime.i18n("cj_i18n_00153","Trending"),ee=cjMaterial.createElement("button",{label:bmRuntime.i18n("cj_i18n_00160","Authorize"),color:de,onClick:L}),J.insertBefore(ee,Q.nextSibling);var e=bmElements.createElement("servicelogo",{labelPrefix:"",label:""});ie.appendChild(e);var t=cjMaterial.createElement("button",{raised:!0,label:bmRuntime.i18n("cj_i18n_00160","Authorize"),color:de,onClick:L});t.classList.add("bm-p-youtube-sidenavbutton"),ie.appendChild(t)}function N(){g.auth.getAccessToken(ce).then(T,I)}function P(){var e=j();return e?cjBasics.urls.create("results",{q:e.q}):""}function D(){var e=P();a(e)}function S(){var e=document.createElement("div");e.classList.add("bm-p-youtube__filters");var t=cjMaterial.createElement("subheader",{color:de,label:bmRuntime.i18n("cj_i18n_00163","Type")});e.appendChild(t);var n=[{value:"episode",label:bmRuntime.i18n("cj_i18n_00043","Episodes")},{value:"movie",label:bmRuntime.i18n("cj_i18n_00044","Movies")}];return n.forEach(function(t){var n=cjMaterial.createElement("item");n.dataset.filter=t.value,n.textContent=t.label,n.addEventListener("click",function(){Y.searchmenu.hide();var e=Z.value;if(e.indexOf("type:")!==-1){var t=e.split(" ");t.forEach(function(e){e.indexOf("type:")!==-1&&t.splice(t.indexOf(e),1)}),e=t.join(" ")}Z.value="type:"+n.dataset.filter+(e?" "+e:""),y()}),e.appendChild(n)}),t=cjMaterial.createElement("subheader",{color:de,label:bmRuntime.i18n("cj_i18n_00164","Duration")}),e.appendChild(t),n=[{value:"long",label:bmRuntime.i18n("cj_i18n_00040","Longer than 20 min")},{value:"medium",label:bmRuntime.i18n("cj_i18n_00041","Between 4 and 20 min")},{value:"short",label:bmRuntime.i18n("cj_i18n_00042","Shorter than 4 min")}],n.forEach(function(t){var n=cjMaterial.createElement("item");n.dataset.filter=t.value,n.textContent=t.label,n.addEventListener("click",function(){Y.searchmenu.hide();var e=Z.value;if(e.indexOf("duration:")!==-1){var t=e.split(" ");t.forEach(function(e){e.indexOf("duration:")!==-1&&t.splice(t.indexOf(e),1)}),e=t.join(" ")}Z.value="duration:"+n.dataset.filter+(e?" "+e:""),y()}),e.appendChild(n)}),e}function O(){return ne&&"videoPlayer"===ne.selected?"watch?v="+W:A&&"myVideos"===A.selected?"my_videos":e.classList.contains("search")?P():""}function B(){t.setOpenInNewHandler(function(){var e=O();a(e)}),Y=bmElements.createElement("pageheader",{color:"#fff",light:!0,pageId:"youtube",includeSearchMenu:!0,searchboxProperties:{color:de,onClear:function(){Y.searchmenu.hide()},onInput:function(e){Y.searchmenu.classList.add("hide-filters"),h(e)},onSubmit:y,onSubmitAlt:D}}),e.appendChild(Y);var n=cjMaterial.createElement("iconbutton",{iconName:"__mdi:arrow_drop_down",onClick:function(){Y.searchmenu.classList.contains("hide-filters")?(Y.searchmenu.classList.remove("hide-filters"),Y.searchmenu.open()):Y.searchmenu.toggle()}});Y.searchbox.appendChild(n),te=cjMaterial.createElement("list"),te.classList.add("bm-ele-autocomplete"),te.addEventListener("click",function(e){var t=e.target.dataset.value;Y.searchbox.value=t,y(t)}),Y.searchmenu.appendChild(te),Z=Y.searchbox,ae(Z.select);var l=S();Y.searchmenu.appendChild(l),F={whatToWatch:{label:bmRuntime.i18n("cj_i18n_00151","What to watch"),action:function(){a("")},iconName:"__mdi:home",external:!0,newTabUrl:i("")},myVideos:{label:bmRuntime.i18n("cj_i18n_00152","My videos"),action:R,iconName:"__mdi:video_library",newTabUrl:i("my_videos")},trending:{label:bmRuntime.i18n("cj_i18n_00153","Trending"),action:_,iconName:"__mdi:whatshot",newTabUrl:i("feed/trending")},mySubscriptions:{label:bmRuntime.i18n("cj_i18n_00154","Subscriptions"),action:function(){a("feed/subscriptions")},iconName:"__mdi:my_subscriptions",external:!0,newTabUrl:i("feed/subscriptions")},history:{label:bmRuntime.i18n("cj_i18n_00155","History"),action:function(){a("feed/history")},iconName:"__mdi:history",external:!0,newTabUrl:i("feed/history")},watchLater:{label:bmRuntime.i18n("cj_i18n_00076","Watch later"),action:function(){a("playlist?list=WL")},iconName:"__mdi:schedule",external:!0,newTabUrl:i("playlist?list=WL")}},bmRuntime.toggleLoading("on",e),ie=cjMaterial.createElement("drawer",{color:de}),e.appendChild(ie),ne=bmElements.createElement("multiplecontainer",{items:{searchResults:{content:function(){return cjMaterial.createElement("container")},afterLoad:w},videoPlayer:{content:function(){return cjMaterial.createElement("container",{darker:!0})},afterLoad:C}},selected:"searchResults"}),e.appendChild(ne),N()}var A,U,q,W,z,H,F,V,Y,Z,$,G,J,K,Q,X,ee,te,ne,ie,ae=t.onPageDisplay,le="https://www.googleapis.com/youtube/v3/",ce=["https://www.googleapis.com/auth/youtube.readonly"],oe=15,re=[],de="#ea4335";e.classList.add("bm-ele--loading--red"),B()}});