cjModules.define(function(){"use strict";return function(e){function t(e){y.forEach(function(t){bmRuntime.toggleLoading("on",t.container),t.chart.set(e).execute()})}function a(){t({query:{"start-date":v.start,"end-date":v.end}})}function n(e){var t=document.createDocumentFragment(),n=document.createElement("label");n.textContent=e,t.appendChild(n);var i=document.createElement("input");return i.type="date",i.value=v[e],i.addEventListener("change",function(){var t=i.value;v[e]=t,p["start"===e?"end":"start"]["start"===e?"min":"max"]=t,p.start.checkValidity(),p.end.checkValidity(),a()}),i.min=v["start"===e?"min":"start"],i.max=v["start"===e?"end":"today"],t.appendChild(i),Object.defineProperties(t,{checkValidity:{value:function(){var e=i.value;n.classList.toggle("invalid",!(e&&e>=i.min&&e<=i.max))}},min:{get:function(){return i.min},set:function(e){i.min=e}},max:{get:function(){return i.max},set:function(e){i.max=e}}}),t}function i(){if(f===!1){f=!0;var t=bmElements.createElement("fulldialog",{serviceLogo:{label:bmRuntime.i18n("cj_i18n_00186","Analytics")},iconName:"analytics",message:bmRuntime.i18n("cj_i18n_00368","Before you can use this page, you need to give access to load your Google Analytics data"),actionLabel:bmRuntime.i18n("cj_i18n_00224","Give permission"),action:function(){g.auth.requestPermission(h)}});e.appendChild(t)}}function c(){var e=document.createDocumentFragment(),t=cjMaterial.createElement("appbar",{color:"#fafafa",light:!0});m=document.createElement("div"),m.className="analytics-view-selector analytics-loading",t.appendChild(m);var a=bmElements.createElement("maintoolbarbuttons","analytics");t.appendChild(a),e.appendChild(t);var i=cjMaterial.createElement("appbar",{color:"#fafafa",light:!0,secondary:!0}),c=document.createElement("div");return c.className="analytics-date-selector",i.appendChild(c),e.appendChild(i),p.start=n("start"),p.end=n("end"),c.appendChild(p.start),c.appendChild(p.end),e}function o(){var e=new gapi.analytics.ViewSelector({container:m});m.classList.remove("analytics-loading"),e.on("change",function(e){t({query:{ids:e}})}),e.execute()}function r(t){gapi.analytics.auth.authorize({serverAuth:{access_token:t}}),bmRuntime.toggleLoading("off",e)}function s(){y.forEach(function(e){var t=cjMaterial.createElement("subheader",{label:e.title});u.appendChild(t);var a=cjMaterial.createElement("card",{withPadding:!0});a.classList.add("chart-card"),e.container=a,bmRuntime.toggleLoading("on",a),e.chart=new gapi.analytics.googleCharts.DataChart({reportType:"ga",query:{dimensions:e.dimensions,metrics:e.metrics,"start-date":v.start,"end-date":v.end},chart:{type:e.type,container:a,options:{width:360}}}),e.chart.on("success",function(){bmRuntime.toggleLoading("off",e.container)}),u.appendChild(e.container)})}function l(){cjgModules.load("analytics").then(function(){gapi.analytics.ready(function(){g.auth.getAccessToken(h).then(r,i),s(),o(),bmRuntime.toggleLoading("off",e)})})}function d(){bmRuntime.toggleLoading("on",e);var t=c();e.appendChild(t),u=cjMaterial.createElement("container",{scrollable:!0,shadow:!0,darker:!0}),e.appendChild(u),l()}var m,u,p={},f=!1,h=["https://www.googleapis.com/auth/analytics.readonly"],y=[{title:bmRuntime.i18n("cj_i18n_00364","Site traffic"),type:"LINE",metrics:"ga:sessions",dimensions:"ga:date"},{title:bmRuntime.i18n("cj_i18n_00365","Average page load times"),type:"COLUMN",metrics:"ga:avgPageLoadTime",dimensions:"ga:date"},{title:bmRuntime.i18n("cj_i18n_00366","Users by country"),type:"GEO",metrics:"ga:users",dimensions:"ga:country"},{title:bmRuntime.i18n("cj_i18n_00367","Pageviews by browser"),type:"PIE",metrics:"ga:pageviews",dimensions:"ga:browser"}],v=function(){var e=new Date,t=new Date;t.setDate(e.getDate()-1);var a=new Date;return a.setDate(e.getDate()-7),{min:"2005-01-01",start:a.toJSON().split("T")[0],end:t.toJSON().split("T")[0],today:e.toJSON().split("T")[0]}}();d()}});