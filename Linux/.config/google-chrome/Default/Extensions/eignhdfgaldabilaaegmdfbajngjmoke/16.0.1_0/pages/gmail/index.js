cjModules.define(function(){"use strict";return function(e,a){function n(){setTimeout(function(){_.open()},100)}function i(a){if(a&&"notAuthorized"===a.error){e.textContent="";var n=bmElements.createElement("fulldialog",{serviceLogo:{labelPrefix:"",label:bmRuntime.i18n("cj_i18n_00416","Gmail")},iconName:"googlemail",message:bmRuntime.i18n("cj_i18n_00320","Before you can use this page, you need to give access to load your Gmail emails"),actionLabel:bmRuntime.i18n("cj_i18n_00224","Give permission"),action:a.authorize});e.appendChild(n)}}function t(e){var a=e.startsWith("tl")&&!e.startsWith("tl/search/"),n=a?"":"none";x.style.display=n,R.style.display=n}function r(e,a){var n=cjBasics.urls.create(C+"users/me/"+e,a);return g.request(n,{fetchAs:"json"},{scope:A})["catch"](i)}function l(){return r("labels").then(function(e){var a=e.labels;return g.cache.setItem("gmailLabelsCache",a),a})}function o(){return g.cache.getItem("gmailLabelsCache").then(function(e){return Array.isArray(e)?e:Promise.reject("No cache available")})}function s(e){var a,n=[],i=!1;return e.forEach(function(e){if("UNREAD"!==e.id)if("system"===e.type){var t=0===e.id.indexOf("CATEGORY_");if(!t||"hide"!==e.messageListVisibility||"labelHide"!==e.labelListVisibility){t&&(i=!0);var r=H[e.id],l={id:e.id,newTabUrl:L+"#"+r.hash,label:r.label,iconName:r.iconName,sortIndex:r.sortIndex,iframeHash:r.iframeHash};"INBOX"===e.id?a=l:n.push(l)}}else n.push({id:e.id,newTabUrl:L+"#label/"+e.name,label:e.name,iconName:"__mdi:label",sortIndex:5e3,iframeHash:e.name.toLowerCase().replace(/ /g,"-")})}),i===!1&&n.push(a),n.push({id:"ALL",newTabUrl:L+"#"+H.ALL.hash,label:H.ALL.label,iconName:H.ALL.iconName,sortIndex:H.ALL.sortIndex,iframeHash:H.ALL.iframeHash}),n.sort(function(e,a){return e.sortIndex===a.sortIndex?e.label>a.label?1:-1:e.sortIndex>a.sortIndex?1:-1}),{labels:n,categories:i}}function m(e){return r("labels/"+e,{}).then(function(e){return e&&"threadsUnread"in e?e.threadsUnread:null})}function c(e){I.src=T.split("#")[0]+"#"+e,t(e)}function h(){var e=bmElements.createElement("pageheader",{color:"#ea4335",pageId:"gmail",searchboxProperties:{onSubmit:function(e){c("tl/search/"+e)}}});return e}function d(e){return bmElements.createElement("drawertabs",{onChange:function(e,a){c("tl/"+a.iframeHash)},items:e.labels,selected:e.categories?"CATEGORY_PERSONAL":"INBOX"})}function u(){var e=cjMaterial.createElement("drawer",{color:"#ea4335"});bmRuntime.toggleLoading("on",e);var a=bmElements.createElement("servicelogo",{labelPrefix:"",label:bmRuntime.i18n("cj_i18n_00416","Gmail")});e.appendChild(a);var n=!1;return o().then(s).then(function(a){n||(N=a,f=d(a),e.appendChild(f))}),l().then(s).then(function(a){return n=!0,bmRuntime.toggleLoading("off",e),f&&e.removeChild(f),N=a,f=d(a),e.appendChild(f),a.labels}).then(function(e){e.forEach(function(e){m(e.id).then(function(a){null!==a&&(f.getEle(e.id).dataset.unreadcount=a)})})}),e}function b(){var i=h();e.appendChild(i),E(i.searchbox.select),x=cjMaterial.createElement("appbar",{secondary:!0,floating:"left"}),x.classList.add("mail-floating-toolbar"),e.appendChild(x),p=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:n}),x.appendChild(p),_=u(),e.appendChild(_),I=bmElements.createElement("iframe",{src:T}),e.appendChild(I),R=cjMaterial.createElement("fab",{iconName:"__mdi:create",onClick:function(){c("co")}}),e.appendChild(R),window.addEventListener("message",function(e){var a=e.data.mailPageChange;a&&(a.startsWith("mn")?(n(),c("tl")):t(e.data.mailPageChange)),e.data.mailPageUrl&&(T=e.data.mailPageUrl)}),a.setOpenInNewHandler(function(){var e=!1,a=N&&N.labels,n=f&&f.selected;a&&n&&a.forEach(function(a){a.id===n&&(bmRuntime.openTab(a.newTabUrl),e=!0)}),e||bmRuntime.openTab(L)})}var _,f,p,x,R,I,N,E=a.onPageDisplay,A=["https://www.googleapis.com/auth/gmail.readonly"],C="https://www.googleapis.com/gmail/v1/",L="https://mail.google.com/mail/u/"+g.account.authuser+"/",j="bm_mail_gmail_"+g.account.authuser+"_"+g.account.userid,T=cjBasics.urls.create("https://mail.google.com/mail/mu/mp/",{mui:j,hl:"en",authuser:g.account.authuser},"#tl"),H={INBOX:{sortIndex:0,label:bmRuntime.i18n("cj_i18n_00299","Inbox"),hash:"inbox",iframeHash:"Inbox",iconName:"__mdi:inbox"},CATEGORY_PERSONAL:{sortIndex:1,label:bmRuntime.i18n("cj_i18n_00178","Primary"),hash:"inbox",iframeHash:"priority/^smartlabel_personal",iconName:"__mdi:inbox"},CATEGORY_SOCIAL:{sortIndex:2,label:bmRuntime.i18n("cj_i18n_00312","Social"),hash:"inbox",iframeHash:"priority/^smartlabel_social",iconName:"__mdi:people"},CATEGORY_PROMOTIONS:{sortIndex:3,label:bmRuntime.i18n("cj_i18n_00180","Promotions"),hash:"inbox",iframeHash:"priority/^smartlabel_promo",iconName:"__mdi:local_offer"},CATEGORY_UPDATES:{sortIndex:4,label:bmRuntime.i18n("cj_i18n_00313","Updates"),hash:"inbox",iframeHash:"priority/^smartlabel_notification",iconName:"__mdi:info"},CATEGORY_FORUMS:{sortIndex:5,label:bmRuntime.i18n("cj_i18n_00182","Forums"),hash:"inbox",iframeHash:"priority/^smartlabel_group",iconName:"__mdi:question_answer"},STARRED:{sortIndex:6,label:bmRuntime.i18n("cj_i18n_00004","Starred"),hash:"starred",iframeHash:"Starred",iconName:"__mdi:star"},IMPORTANT:{sortIndex:7,label:bmRuntime.i18n("cj_i18n_00184","Important"),hash:"imp",iframeHash:"Important",iconName:"__mdi:label_important"},CHAT:{sortIndex:8,label:bmRuntime.i18n("cj_i18n_00185","Chats"),hash:"chats",iframeHash:"Chats",iconName:"__mdi:hangout"},SENT:{sortIndex:9,label:bmRuntime.i18n("cj_i18n_00303","Sent"),hash:"sent",iframeHash:"Sent%20Mail",iconName:"__mdi:send"},DRAFT:{sortIndex:10,label:bmRuntime.i18n("cj_i18n_00187","Drafts"),hash:"drafts",iframeHash:"Drafts",iconName:"__mdi:drafts"},ALL:{sortIndex:11,label:bmRuntime.i18n("cj_i18n_00188","All Mail"),hash:"all",iframeHash:"All%20Mail",iconName:"__mdi:inbox"},SPAM:{sortIndex:12,label:bmRuntime.i18n("cj_i18n_00306","Spam"),hash:"spam",iframeHash:"Spam",iconName:"__mdi:report"},TRASH:{sortIndex:13,label:bmRuntime.i18n("cj_i18n_00005","Trash"),hash:"trash",iframeHash:"Trash",iconName:"__mdi:delete"}};b()}});