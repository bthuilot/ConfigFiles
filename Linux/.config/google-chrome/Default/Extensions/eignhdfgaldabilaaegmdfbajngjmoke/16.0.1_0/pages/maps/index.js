cjModules.define(function(){"use strict";return function(e,a){function t(e){var a=cjBasics.urls.create(N+"search/",{api:"1",query:e,authuser:g.account.authuser});bmRuntime.openTab(a)}function n(e){var a=document.createElement("div");a.className="bm-p-maps__shortcut",a.addEventListener("click",function(){bmRuntime.openTab(e.linkUrl)});var t=document.createElement("img");t.className="bm-p-maps__shortcut__icon",t.src="/pages/maps/"+e.icon+".svg",a.appendChild(t);var n=document.createElement("p");return n.className="bm-p-maps__shortcut__label",n.textContent=e.label,a.appendChild(n),a}function i(){var e={api:"1",origin:S.value||null,destination:P.value||null};"0"!==g.account.authuser&&(e.authuser=g.account.authuser);var a=cjBasics.urls.create(N+"dir/",e);bmRuntime.openTab(a)}function r(e){e&&E.setPosition(e),E.setVisible(Boolean(e))}function o(e){var a=cjBasics.urls.create("https://maps.googleapis.com/maps/api/place/textsearch/json",{key:g.key,query:e});return cjBasics.ajax(a,{fetchAs:"json"}).then(function(e){if("OK"===e.status){var a=e.results[0];if(a.geometry){var t=a.geometry.viewport;return a.geometry.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(t.southwest.lat,t.southwest.lng),new google.maps.LatLng(t.northeast.lat,t.northeast.lng)),delete a.geometry.viewport,a}}return Promise.reject(e.status)})}function l(e){var a=cjBasics.urls.create("https://maps.googleapis.com/maps/api/place/details/json",{key:g.key,placeid:e});return cjBasics.ajax(a,{fetchAs:"json"}).then(function(e){return"OK"===e.status?e.results:Promise.reject(e.status)})}function s(e){e.geometry.viewport?w.fitBounds(e.geometry.viewport):(w.setCenter(e.geometry.location),w.setZoom(17)),L.setBounds(w.getBounds()),w.panBy(0,-80)}function c(e){v.textContent="";var a=cjMaterial.createElement("title",{label:e.placeName});if(v.appendChild(a),e.address&&e.address.length>0){var t=cjMaterial.createElement("secondarytext");t.innerHTML=e.address,v.appendChild(t)}if(e.transitContainer){var n=document.createElement("div");n.className="gm-style",n.appendChild(e.transitContainer),v.appendChild(n)}j=e.mapsUrl,j||l(e.placeId).then(function(e){j=e.url});var i=cjMaterial.createElement("button",{color:"#4285f4",label:bmRuntime.i18n("cj_i18n_00124","View on Google Maps"),onClick:function(){bmRuntime.openTab(j)}});v.appendChild(i);var r=cjMaterial.createElement("fab",{iconName:"__mdi:directions",onClick:function(){bmRuntime.openTab(e.directionsUrl)}});v.appendChild(r),v.classList.add("bm-p-maps__results--visible")}function m(e){T&&O[T].layer.setMap(null),T=e;var a=O[e];if(a){if(!a.loaded){a.loaded=!0;var t=a.layerName;t&&(a.layer=new google.maps[t])}a.layer.setMap(w)}}function u(){var e=cjMaterial.createElement("drawer",{color:"#4285f4"}),a=bmElements.createElement("servicelogo",{label:bmRuntime.i18n("cj_i18n_00423","Maps"),color:"color"});e.appendChild(a);var t=bmElements.createElement("drawertabs",{items:O,onChange:m,onActiveClick:function(){t.selected=null,m(null)}});e.appendChild(t);var n={hybrid:{iconName:"__mdi:satellite",label:bmRuntime.i18n("cj_i18n_00125","Satellite")},terrain:{iconName:"__mdi:terrain",label:bmRuntime.i18n("cj_i18n_00126","Terrain"),divider:!0},places:{label:bmRuntime.i18n("cj_i18n_00127","Your places"),newTabUrl:N+"@37.0625,-95.677068,4z/data=!4m2!10m1!1e2?authuser="+g.account.authuser,iconName:"__mdi:place",external:!0},contributions:{label:bmRuntime.i18n("cj_i18n_00128","Your contributions"),newTabUrl:N+"contrib/?authuser="+g.account.authuser,iconName:"__mdi:rate_review",external:!0},timeline:{label:bmRuntime.i18n("cj_i18n_00129","Your timeline"),newTabUrl:N+"timeline?authuser="+g.account.authuser,iconName:"__mdi:timeline",external:!0}};return C=bmElements.createElement("drawertabs",{items:n,onChange:function(e){n[e].external?bmRuntime.openTab(n[e].newTabUrl):w.setMapTypeId(e)},onActiveClick:function(){w.setMapTypeId("roadmap"),C.selected=null}}),e.appendChild(C),e}function p(){E.setVisible(!1)}function d(e,a){var t={api:"1",destination:a.split(" ").join("+")};return"0"!==g.account.authuser&&(t.authuser=g.account.authuser),e&&(t.destination_place_id=e),cjBasics.urls.create(N+"dir/",t)}function b(e,a,t){if(!a&&e)return cjBasics.urls.insertParameter(e,"authuser",g.account.authuser);var n={api:"1",query:t.split(" ").join("+")};return"0"!==g.account.authuser&&(n.authuser=g.account.authuser),a&&(n.query_place_id=a),cjBasics.urls.create(N+"search/",n)}function h(e){e.geometry.location?r(e.geometry.location):p(),s(e);var a=e.name||e.address_components[0].short_name,t=e.place_id;c({placeId:e.place_id,placeName:a,address:e.formatted_address,mapsUrl:b(e.url,t,a),directionsUrl:d(t,a)})}function _(){p(),v.classList.remove("bm-p-maps__results--visible")}function f(){bmRuntime.toggleLoading("on",e);var a=u();e.appendChild(a);var n=cjMaterial.createElement("appbar",{floating:!0,light:!0}),i=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){a.open()}});n.appendChild(i),y=bmElements.createElement("searchbox",{color:"#4285f4",raised:!0,onClear:_,onSubmitAlt:t}),M(y.select),n.appendChild(y),v=cjMaterial.createElement("card",{withPadding:!0}),v.classList.add("bm-p-maps__results"),y.appendChild(v);var l=bmElements.createElement("maintoolbarbuttons","maps");n.appendChild(l),e.appendChild(n);var s=cjMaterial.createElement("card");s.classList.add("bm-p-maps__maptype"),s.dataset.satelliteText=bmRuntime.i18n("cj_i18n_00289","Satellite"),s.dataset.mapText=bmRuntime.i18n("cj_i18n_00290","Map"),s.addEventListener("click",function(){var e="hybrid"===w.mapTypeId;w.setMapTypeId(e?"roadmap":"hybrid")}),e.appendChild(s);var m=cjMaterial.createElement("container");m.classList.add("bm-p-maps__map"),e.appendChild(m),A.then(function(){w=new google.maps.Map(m,{clickableIcons:!0,panControl:!1,center:new google.maps.LatLng(10,0),minZoom:1,zoom:1,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.ZoomControlStyle.SMALL},fullscreenControl:!1,styles:[{featureType:"administrative",elementType:"geometry.fill",stylers:[{visibility:"off"}]}]}),w.panBy(0,-32),cjBasics.loadScriptFile("https://www.google.com/jsapi").then(function(){var a=google.loader.ClientLocation;a?(w.setCenter({lat:a.latitude,lng:a.longitude}),w.setZoom(6),L.setBounds(w.getBounds())):e.classList.add("bm-p-maps--large-zoom")});var a=w.getStreetView();google.maps.event.addListener(a,"visible_changed",function(){e.classList.toggle("streetview",a.getVisible())}),E=new google.maps.Marker({map:w,visible:!1}),google.maps.InfoWindow.prototype.setPosition=r,google.maps.InfoWindow.prototype.setContent=function(e){this.setMap(null);var a=e.querySelector(".title").textContent;y.value=a;var t=e.querySelector(".view-link a").href;t=cjBasics.urls.insertParameter(t,"authuser",g.account.authuser);var n=e.querySelector(".transit-container");if(n){var i=n.querySelector(".transit-title:not([style]) span");n.removeChild(i.parentNode),a=i.textContent}c({placeName:a,address:e.querySelector(".address").innerHTML,transitContainer:n,mapsUrl:t,directionsUrl:cjBasics.urls.insertParameter(t,"daddr",a.split(" ").join("+"))})},google.maps.InfoWindow.prototype.open=function(){},w.addListener("maptypeid_changed",function(){var a="hybrid"===w.mapTypeId;C.selected=w.mapTypeId,e.classList.toggle("satellite",a)}),w.addListener("zoom_changed",function(){e.classList.toggle("bm-p-maps--large-zoom",1===w.zoom)}),L=new google.maps.places.Autocomplete(y.inputElement),L.bindTo("bounds",w),google.maps.event.addListener(L,"place_changed",function(){var e=L.getPlace();e.geometry?h(e):o(y.value).then(h),y.blur()}),bmRuntime.toggleLoading("off",e)})}var v,y,C,j,w,L,E,T,M=a.onPageDisplay,N="https://www.google.com/maps/",B=cjBasics.isFirefox;if(B){e.classList.add("bm-p-maps--simple");var R=bmElements.createElement("pageheader",{color:"#4285f4",pageId:"maps",light:!1,searchboxProperties:{onSubmit:t}});e.appendChild(R);var k=cjMaterial.createElement("container",{scrollable:!0,darker:!0}),x=cjMaterial.createElement("card");x.classList.add("bm-p-maps__navcard");var I=cjMaterial.createElement("title",{label:"New direction"});I.classList.add("bm-p-maps__title"),x.appendChild(I);var S,P;S=cjMaterial.createElement("searchbox",{color:"#4285f4",label:"Starting point",iconName:null,onSubmit:i}),S.classList.add("bm-p-maps__navbox"),x.appendChild(S),P=cjMaterial.createElement("searchbox",{color:"#4285f4",label:"Destination",iconName:null,onSubmit:i}),P.classList.add("bm-p-maps__navbox"),x.appendChild(P);var U=cjMaterial.createElement("fab",{iconName:"__mdi:directions",color:"#4285f4",onClick:i});U.classList.add("bm-p-maps__fab"),x.appendChild(U),k.appendChild(x);var q=[{label:bmRuntime.i18n("cj_i18n_00127","Your places"),linkUrl:N+"@37.0625,-95.677068,4z/data=!4m2!10m1!1e2?authuser="+g.account.authuser,icon:"places"},{label:bmRuntime.i18n("cj_i18n_00128","Your contributions"),linkUrl:N+"contrib/?authuser="+g.account.authuser,icon:"contributions"},{label:bmRuntime.i18n("cj_i18n_00129","Your timeline"),linkUrl:N+"timeline?authuser="+g.account.authuser,icon:"timeline"}],z=document.createElement("div");return z.className="bm-p-maps__shortcutcontainer",q.forEach(function(e){var a=n(e);z.appendChild(a)}),k.appendChild(z),void e.appendChild(k)}a.setOpenInNewHandler(function(){var e=N+"?authuser="+g.account.authuser;j&&E.getVisible()&&(e=j),bmRuntime.openTab(e)});var O={traffic:{iconName:"__mdi:traffic",label:bmRuntime.i18n("cj_i18n_00032","Traffic"),layerName:"TrafficLayer"},transit:{iconName:"__mdi:directions_transit",label:bmRuntime.i18n("cj_i18n_00033","Public Transport"),layerName:"TransitLayer"},bicycling:{iconName:"__mdi:directions_bike",label:bmRuntime.i18n("cj_i18n_00034","Cycling"),layerName:"BicyclingLayer"}},A=new Promise(function(e){var a="mapsPageApiCallback";window[a]=function(){delete window[a],e()};var t=cjBasics.urls.create("https://maps.googleapis.com/maps/api/js",{key:g.key,callback:a,libraries:"places",language:g.lang});cjBasics.loadScriptFile(t)});f()}});