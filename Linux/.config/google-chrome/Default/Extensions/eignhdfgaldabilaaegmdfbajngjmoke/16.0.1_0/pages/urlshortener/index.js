cjModules.define(function(){"use strict";return function(e,t){function n(e){if(!e)return bmRuntime.i18n("cj_i18n_00338","Now");var t=e.split("T")[0].split("-"),n=[parseFloat(t[0]),parseFloat(t[1])-1,parseFloat(t[2])];return cjBasics.datetime.printLegacyDate(n)}function r(e){return e?e.allTime.shortUrlClicks:"0"}function i(e){var t=cjMaterial.createElement("card",{withPadding:!0});t.addEventListener("click",function(){bmRuntime.openTab("https://goo.gl/#analytics/goo.gl/"+e.id.split("://goo.gl/")[1]+"/all_time")});var i=cjMaterial.createElement("title",{label:e.longUrl.split("?")[0]});i.classList.add("long-url-title"),t.appendChild(i);var a=cjMaterial.createElement("secondarytext",{label:bmRuntime.i18n("cj_i18n_00339","Short url")+": "}),l=document.createElement("a");l.addEventListener("click",function(e){e.stopPropagation(),bmRuntime.openTab(l.href)}),l.textContent=e.id,l.href=e.id,a.appendChild(l),t.appendChild(a);var o=cjMaterial.createElement("secondarytext",{label:bmRuntime.i18n("cj_i18n_00340","Created")+": "+n(e.created)});t.appendChild(o);var c=cjMaterial.createElement("secondarytext",{label:bmRuntime.i18n("cj_i18n_00341","Click")+": "+r(e.analytics)});return t.appendChild(c),t}function a(){var e=cjBasics.urls.create(L+"url/history",{projection:"ANALYTICS_CLICKS",fields:"items(analytics,created,id,longUrl)"});return g.request(e,{fetchAs:"json"},{scope:M}).then(function(e){return j=!0,e.items},function(){return j=!1,Promise.reject()})}function l(e){var t={method:"POST",fetchAs:"json",body:JSON.stringify({longUrl:e}),headers:{"Content-Type":"application/json"}};return j?g.request(L+"url",t,{scope:M}):cjBasics.ajax(L+"url?key="+g.key,t)}function o(t){var n=cjMaterial.createElement("card",{withPadding:!0});n.classList.add("results-card");var r=document.createElement("div"),i=bmRuntime.i18n("cj_i18n_00048","Press CTRL-C to copy");cjBasics.isMac&&(i=i.replace("CTRL","CMD")),r.dataset.tooltipText=i,r.className="tooltip tooltip--visible";var a=document.createElement("input");a.className="result",a.spellcheck=!1,a.readOnly=!0,a.value=t.shortUrl,a.addEventListener("blur",function(){r.classList.remove("tooltip--visible")}),a.addEventListener("click",function(){r.classList.add("tooltip--visible"),setTimeout(function(){a.select()},10)}),setTimeout(function(){a.select()},10),r.appendChild(a),n.appendChild(r);var l=cjMaterial.createElement("secondarytext",{label:bmRuntime.i18n("cj_i18n_00049","0 minutes ago")+" - "});l.classList.add("details-container");var o=document.createElement("a");o.className="details-link",o.href="https://goo.gl/#analytics/goo.gl/"+t.shortUrl.split("://goo.gl/")[1].split("/")[0]+"/all_time",l.appendChild(o),n.appendChild(l);var c=document.createElement("div"),s=document.createElement("a");s.className="originUrlButton",s.href=t.longUrl,s.textContent=t.longUrl,c.appendChild(s),n.appendChild(c),_.textContent="",_.appendChild(n),bmRuntime.toggleLoading("off",e)}function c(t){_.textContent="";var n=cjMaterial.createElement("subheader",{label:"invalidUrl"===t.errorMessage?bmRuntime.i18n("cj_i18n_00050","Please fill in a valid URL"):bmRuntime.i18n("cj_i18n_00051","Error while generating short url")});_.appendChild(n),bmRuntime.toggleLoading("off",e)}function s(t){bmRuntime.toggleLoading("on",e),w(t).then(o,c)}function u(){j=!0,y.url&&s(y.url)}function d(){j=!1,y.url&&s(y.url);var e=cjMaterial.createElement("card",{withPadding:!0});e.textContent=bmRuntime.i18n("cj_i18n_00342","In order to view your recently shortened urls, you need to")+"\n",b=cjMaterial.createElement("button",{raised:!0,label:bmRuntime.i18n("cj_i18n_00160","Authorize"),onClick:function(){g.auth.requestPermission(M)}}),e.appendChild(b),E.appendChild(e),bmRuntime.toggleLoading("off",E)}function m(){return a().then(function(e){e.forEach(function(e){var t=i(e);E.appendChild(t)}),bmRuntime.toggleLoading("off",E)})}function p(){var e=cjMaterial.createElement("container",{scrollable:!0,shadow:!0,darker:!0});_=document.createElement("div"),_.className="create",e.appendChild(_),E=document.createElement("div"),E.className="list",bmRuntime.toggleLoading("on",E);var t=cjMaterial.createElement("subheader",{label:bmRuntime.i18n("cj_i18n_00344","Previously shortened")});return E.appendChild(t),e.appendChild(E),e}function h(){R(function(){if(e.querySelector(".results-card")){var t=_.querySelector("input");t.focus(),t.select()}else C.select()})}function f(){y=cjBasics.urls.getParameters(),y.url?(C.value=y.url,h()):browser.tabs.query({currentWindow:!0,active:!0}).then(function(e){var t=e[0],n=t.url;n&&(C.value=t.url),h()})}function v(){var t=bmElements.createElement("pageheader",{color:"#3367d6",pageId:"urlshortener",searchboxProperties:{iconName:"__mdi:link",onSubmit:s,label:bmRuntime.i18n("cj_i18n_00345","Enter a URL to shorten")}});C=t.searchbox,e.appendChild(t);var n=p();e.appendChild(n),f(),m().then(u,d)}var b,j,C,E,_,y,R=t.onPageDisplay,L="https://www.googleapis.com/urlshortener/v1/",M=["https://www.googleapis.com/auth/urlshortener"],w=function(){function e(e){return e.indexOf("http://")!==-1||e.indexOf("https://")!==-1}return function(t){return e(t)?l(t).then(function(e){if(e.id){var n=i(e);return E.insertBefore(n,E.querySelector(".cj-md-card")),{status:"success",shortUrl:e.id,longUrl:t}}return{status:"error",errorMessage:e.error.message,response:e}},function(){return{status:"error",errorMessage:"error while receiving a short url",response:"error"}}):Promise.reject({status:"error",errorMessage:"invalidUrl"})}}();v()}});